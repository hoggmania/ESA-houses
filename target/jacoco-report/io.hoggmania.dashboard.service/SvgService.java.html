<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SvgService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">quarkus-dashboard-generator</a> &gt; <a href="index.source.html" class="el_package">io.hoggmania.dashboard.service</a> &gt; <span class="el_source">SvgService.java</span></div><h1>SvgService.java</h1><pre class="source lang-java linenums">package io.hoggmania.dashboard.service;

import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import io.quarkus.qute.Template;
import io.quarkus.qute.TemplateInstance;
import io.quarkus.logging.Log;
import io.quarkus.qute.Location;
import io.hoggmania.dashboard.config.DashboardLayoutConfig;
import io.hoggmania.dashboard.util.ColorPalette;
import io.hoggmania.dashboard.util.StringUtils;
import io.hoggmania.dashboard.util.UrlUtils;
import io.hoggmania.dashboard.model.RenderItem;
import io.hoggmania.dashboard.model.DomainGroup;
import io.hoggmania.dashboard.model.ESA;
import io.hoggmania.dashboard.model.Governance;
import io.hoggmania.dashboard.model.Capabilities;
import io.hoggmania.dashboard.model.ComponentItem;
import io.hoggmania.dashboard.model.Domain;


import org.apache.batik.transcoder.TranscoderInput;
import org.apache.batik.transcoder.TranscoderOutput;
import org.apache.batik.transcoder.image.PNGTranscoder;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.nio.charset.StandardCharsets;

@ApplicationScoped
<span class="fc" id="L31">public class SvgService {</span>

    @Inject
    @Location(&quot;dashboard.svg.qute&quot;)
    Template dashboard; // Explicitly locate templates/dashboard.svg.qute

    /**
     * Renders an SVG dashboard from an ESA model.
     * The dashboard includes governance components, capability domains, and a legend.
     * Layout is automatically calculated based on the number of components and domains.
     * 
     * @param root the ESA model containing dashboard data
     * @return the rendered SVG as a string
     * @throws ValidationException if the ESA model is invalid
     */
    public String renderSvg(ESA root) {
        // Validate input first
<span class="fc" id="L48">        ESA.validateESA(root);</span>
<span class="fc" id="L49">        Log.info(root.toString());</span>
        // Layout constants from config
<span class="fc" id="L51">        final int maxDomainColumnsPerRow = DashboardLayoutConfig.MAX_DOMAIN_COLUMNS_PER_ROW;</span>
<span class="fc" id="L52">        final float gapX = DashboardLayoutConfig.GAP_X;</span>
<span class="fc" id="L53">        final float gapY = DashboardLayoutConfig.GAP_Y;</span>
<span class="fc" id="L54">        final float canvasWidth = DashboardLayoutConfig.DEFAULT_CANVAS_WIDTH;</span>
<span class="fc" id="L55">        final float leftMargin = DashboardLayoutConfig.LEFT_MARGIN;</span>
<span class="fc" id="L56">        final float rightLimit = canvasWidth - leftMargin;</span>
<span class="fc" id="L57">        final float domainStartX = DashboardLayoutConfig.DOMAIN_START_X;</span>
<span class="fc" id="L58">        final float boxW = DashboardLayoutConfig.calculateBoxWidth(canvasWidth, leftMargin, domainStartX, maxDomainColumnsPerRow);</span>
<span class="fc" id="L59">        final float boxH = DashboardLayoutConfig.BOX_HEIGHT;</span>
<span class="fc" id="L60">        final float headerOffset = DashboardLayoutConfig.HEADER_OFFSET;</span>
<span class="fc" id="L61">        final float headerHeight = DashboardLayoutConfig.HEADER_HEIGHT;</span>
<span class="fc" id="L62">        final float rowGapY = DashboardLayoutConfig.ROW_GAP_Y;</span>
<span class="fc" id="L63">        final float spaceW = DashboardLayoutConfig.calculateSpaceWidth(boxW);</span>
<span class="fc" id="L64">        final float governanceHeaderY = DashboardLayoutConfig.GOVERNANCE_HEADER_Y;</span>
<span class="fc" id="L65">        final float governanceHeaderHeight = DashboardLayoutConfig.GOVERNANCE_HEADER_HEIGHT;</span>
<span class="fc" id="L66">        final float governanceHeaderToRowGap = DashboardLayoutConfig.GOVERNANCE_HEADER_TO_ROW_GAP;</span>
<span class="fc" id="L67">        final float governanceRowGap = DashboardLayoutConfig.GOVERNANCE_ROW_GAP;</span>
<span class="fc" id="L68">        final float governanceToCapabilitiesGap = DashboardLayoutConfig.GOVERNANCE_TO_CAPABILITIES_GAP;</span>
<span class="fc" id="L69">        final float capabilitiesHeaderToDomainsGap = DashboardLayoutConfig.CAPABILITIES_HEADER_TO_DOMAINS_GAP;</span>
<span class="fc" id="L70">        final int nameCharsPerLine = DashboardLayoutConfig.NAME_CHARS_PER_LINE;</span>
<span class="fc" id="L71">        final int capabilityCharsPerLine = DashboardLayoutConfig.CAPABILITY_CHARS_PER_LINE;</span>
<span class="fc" id="L72">        final int maxNameLines = DashboardLayoutConfig.MAX_NAME_LINES;</span>
<span class="fc" id="L73">        final int maxCapabilityLines = DashboardLayoutConfig.MAX_CAPABILITY_LINES;</span>
<span class="fc" id="L74">        final int maxRowsPerColumn = DashboardLayoutConfig.MAX_ROWS_PER_COLUMN;</span>
<span class="fc" id="L75">        final float domainSectionGap = DashboardLayoutConfig.DOMAIN_SECTION_GAP;</span>
<span class="fc" id="L76">        final float textLeftX = DashboardLayoutConfig.TEXT_LEFT_X;</span>
<span class="fc" id="L77">        final float textCenterX = boxW / 2f;</span>
<span class="fc" id="L78">        final float iconPosX = boxW - DashboardLayoutConfig.ICON_POS_X_OFFSET;</span>

<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        LinkText titleLink = parseLinkField(root != null ? root.title : null);</span>
<span class="fc" id="L81">        String title = sanitizeNullable(titleLink.text);</span>
<span class="fc" id="L82">        java.util.List&lt;InitiativeGradient&gt; initiativeGradients = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L83">        float domainStartY = 230f;</span>
<span class="fc" id="L84">        float capabilitiesHeaderY = 155f;</span>
<span class="fc" id="L85">        float capabilitiesHeaderTextY = capabilitiesHeaderY + 18f;</span>
<span class="fc" id="L86">        float capabilitiesIconY = capabilitiesHeaderY + 3f;</span>
<span class="fc" id="L87">        float governanceContentBottom = governanceHeaderY + governanceHeaderHeight + governanceHeaderToRowGap + boxH;</span>

        // Governance items (horizontal row)
<span class="fc" id="L90">        java.util.List&lt;RenderItem&gt; governanceItems = new java.util.ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">        Governance gov = root != null ? root.governance : null;</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">        LinkText govTitleLink = parseLinkField(gov != null ? gov.title : null);</span>
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">        String govTitle = gov != null ? sanitizeNullable(govTitleLink.text) : null;</span>
<span class="fc" id="L94">        String govTitleHref = govTitleLink.href;</span>
<span class="pc bpc" id="L95" title="2 of 4 branches missed.">        if (gov != null &amp;&amp; gov.components != null) {</span>
<span class="fc" id="L96">            float govStartX = 20f;</span>
<span class="fc" id="L97">            float govCurrentX = govStartX;</span>
<span class="fc" id="L98">            float govRowTopY = governanceHeaderY + governanceHeaderHeight + governanceHeaderToRowGap;</span>
<span class="fc" id="L99">            float govRowBottom = govRowTopY + boxH;</span>
<span class="fc" id="L100">            boolean hasGovItems = false;</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">            for (int i = 0; i &lt; gov.components.size(); i++) {</span>
<span class="fc" id="L102">                ComponentItem comp = gov.components.get(i);</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">                if (govCurrentX + boxW &gt; rightLimit) {</span>
<span class="nc" id="L104">                    govRowTopY = govRowBottom + governanceRowGap;</span>
<span class="nc" id="L105">                    govRowBottom = govRowTopY + boxH;</span>
<span class="nc" id="L106">                    govCurrentX = govStartX;</span>
                }
<span class="fc" id="L108">                float x = govCurrentX;</span>
<span class="fc" id="L109">                float y = govRowTopY;</span>
<span class="fc" id="L110">                String gradientId = &quot;grad_gov_&quot; + i;</span>
<span class="fc" id="L111">                String border = &quot;#333&quot;;</span>
<span class="pc bpc" id="L112" title="2 of 4 branches missed.">                if (comp.rag != null &amp;&amp; &quot;red&quot;.equalsIgnoreCase(comp.rag)) border = &quot;red&quot;;</span>

                // Determine icon
<span class="fc" id="L115">                String iconKey = comp.icon;</span>
<span class="pc bpc" id="L116" title="2 of 4 branches missed.">                String iconId = (iconKey != null &amp;&amp; !iconKey.isBlank()) ? (&quot;icon-&quot; + iconKey.trim()) : null;</span>

<span class="pc bpc" id="L118" title="1 of 2 branches missed.">                String itemName = comp.name != null ? comp.name : &quot;&quot;;</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">                String itemCapability = comp.capability != null ? comp.capability : &quot;&quot;;</span>
<span class="fc" id="L120">                LinkText nameLink = parseLinkField(itemName);</span>
<span class="fc" id="L121">                LinkText capabilityLink = parseLinkField(itemCapability);</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">                String cleanName = nameLink.text != null ? nameLink.text : &quot;&quot;;</span>
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">                String cleanCapability = capabilityLink.text != null ? capabilityLink.text : &quot;&quot;;</span>
<span class="fc" id="L124">                governanceItems.add(new RenderItem(</span>
                    x, y,
                    cleanName,
                    cleanCapability,
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">                    govTitle != null ? govTitle : &quot;&quot;,</span>
                    comp.status.hex,
                    comp.maturity.hex,
                    gradientId,
                    border,
                    comp.doubleBorder,
                    iconId
                ));
<span class="fc" id="L136">                RenderItem lastGov = governanceItems.get(governanceItems.size()-1);</span>
<span class="fc" id="L137">                lastGov.initiatives = comp.initiatives;</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">                lastGov.showInitiatives = lastGov.initiatives &gt; 0;</span>
<span class="fc" id="L139">                lastGov.nameLines = escapeLines(wrapText(cleanName, nameCharsPerLine, maxNameLines));</span>
<span class="fc" id="L140">                lastGov.capabilityLines = escapeLines(wrapText(cleanCapability, capabilityCharsPerLine, maxCapabilityLines));</span>
<span class="fc" id="L141">                lastGov.nameHref = nameLink.href;</span>
<span class="fc" id="L142">                lastGov.capabilityHref = capabilityLink.href;</span>
<span class="fc" id="L143">                lastGov.initiativeStroke = computeInitiativeStroke(comp, gradientId, initiativeGradients);</span>
<span class="fc" id="L144">                configureTextLayout(lastGov, textCenterX, textLeftX, iconPosX);</span>

<span class="fc" id="L146">                govCurrentX += boxW + gapX;</span>
<span class="fc" id="L147">                govRowBottom = Math.max(govRowBottom, y + boxH);</span>
<span class="fc" id="L148">                hasGovItems = true;</span>
            }
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">            if (hasGovItems) {</span>
<span class="fc" id="L151">                governanceContentBottom = govRowBottom;</span>
            }
        }

<span class="fc" id="L155">        capabilitiesHeaderY = governanceContentBottom + governanceToCapabilitiesGap;</span>
<span class="fc" id="L156">        capabilitiesHeaderTextY = capabilitiesHeaderY + 18f;</span>
<span class="fc" id="L157">        capabilitiesIconY = capabilitiesHeaderY + 3f;</span>
<span class="fc" id="L158">        domainStartY = capabilitiesHeaderY + capabilitiesHeaderToDomainsGap;</span>

        // Capabilities domains (columns)
<span class="fc" id="L161">        java.util.List&lt;DomainGroup&gt; domainGroups = new java.util.ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">        Capabilities capabilities = root != null ? root.capabilities : null;</span>
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">        LinkText capabilitiesTitleLink = parseLinkField(capabilities != null ? capabilities.title : null);</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">        String capabilitiesTitle = capabilities != null ? sanitizeNullable(capabilitiesTitleLink.text) : null;</span>
<span class="fc" id="L165">        String capabilitiesTitleHref = capabilitiesTitleLink.href;</span>
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">        java.util.List&lt;Domain&gt; domains = capabilities != null ? capabilities.domains : null;</span>
<span class="fc" id="L167">        int legendY = 0;</span>
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">        if (domains != null) {</span>
<span class="fc" id="L169">            java.util.List&lt;DomainColumnLayout&gt; columns = buildDomainColumns(domains, boxW, spaceW, maxRowsPerColumn);</span>
<span class="fc" id="L170">            float currentX = domainStartX;</span>
<span class="fc" id="L171">            float rowTopY = domainStartY;</span>
<span class="fc" id="L172">            float rowBottomY = rowTopY;</span>
<span class="fc" id="L173">            int columnsInRow = 0;</span>
<span class="fc" id="L174">            java.util.Map&lt;String, HeaderSpan&gt; headerSpans = new java.util.HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L175" title="All 2 branches covered.">            for (DomainColumnLayout column : columns) {</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">                float columnWidth = column.spacer ? column.width : boxW;</span>
<span class="pc bpc" id="L177" title="2 of 4 branches missed.">                if (columnsInRow &gt;= maxDomainColumnsPerRow || currentX + columnWidth &gt; rightLimit) {</span>
<span class="nc" id="L178">                    rowTopY = rowBottomY + rowGapY;</span>
<span class="nc" id="L179">                    rowBottomY = rowTopY;</span>
<span class="nc" id="L180">                    currentX = domainStartX;</span>
<span class="nc" id="L181">                    columnsInRow = 0;</span>
                }

<span class="fc bfc" id="L184" title="All 2 branches covered.">                if (column.spacer) {</span>
<span class="fc" id="L185">                    currentX += columnWidth + gapX;</span>
<span class="fc" id="L186">                    columnsInRow++;</span>
<span class="fc" id="L187">                    continue;</span>
                }

<span class="fc" id="L190">                float sectionStartY = rowTopY;</span>
<span class="fc" id="L191">                float columnBottom = rowTopY;</span>

<span class="fc bfc" id="L193" title="All 2 branches covered.">                for (DomainSectionChunk section : column.sections) {</span>
<span class="fc" id="L194">                    java.util.List&lt;RenderItem&gt; domainItems = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L195">                    java.util.List&lt;ComponentItem&gt; comps = section.components;</span>
<span class="fc bfc" id="L196" title="All 2 branches covered.">                    for (int compIdx = 0; compIdx &lt; comps.size(); compIdx++) {</span>
<span class="fc" id="L197">                        var comp = comps.get(compIdx);</span>
<span class="fc" id="L198">                        float y = sectionStartY + compIdx * (boxH + gapY);</span>

<span class="fc" id="L200">                        String gradientId = &quot;grad_dom_&quot; + domainGroups.size() + &quot;_&quot; + compIdx;</span>
<span class="fc" id="L201">                        String border = &quot;#333&quot;;</span>
<span class="pc bpc" id="L202" title="1 of 4 branches missed.">                        if (comp.rag != null &amp;&amp; &quot;red&quot;.equalsIgnoreCase(comp.rag)) border = &quot;red&quot;;</span>

<span class="fc" id="L204">                        String iconKey2 = comp.icon;</span>
<span class="pc bpc" id="L205" title="2 of 4 branches missed.">                        String iconId2 = (iconKey2 != null &amp;&amp; !iconKey2.isBlank()) ? (&quot;icon-&quot; + iconKey2.trim()) : null;</span>

<span class="pc bpc" id="L207" title="1 of 2 branches missed.">                        String itemName = comp.name != null ? comp.name : &quot;&quot;;</span>
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">                        String itemCapability = comp.capability != null ? comp.capability : &quot;&quot;;</span>
<span class="fc" id="L209">                        LinkText nameLink2 = parseLinkField(itemName);</span>
<span class="fc" id="L210">                        LinkText capabilityLink2 = parseLinkField(itemCapability);</span>
<span class="pc bpc" id="L211" title="1 of 2 branches missed.">                        String cleanName2 = nameLink2.text != null ? nameLink2.text : &quot;&quot;;</span>
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">                        String cleanCapability2 = capabilityLink2.text != null ? capabilityLink2.text : &quot;&quot;;</span>
<span class="fc" id="L213">                        domainItems.add(new RenderItem(</span>
                            currentX, y,
                            cleanName2,
                            cleanCapability2,
                            section.domainName,
                            comp.status.hex,
                            comp.maturity.hex,
                            gradientId,
                            border,
                            comp.doubleBorder,
                            iconId2
                        ));

<span class="fc" id="L226">                        RenderItem lastDomainItem = domainItems.get(domainItems.size()-1);</span>
<span class="fc" id="L227">                        lastDomainItem.initiatives = comp.initiatives;</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">                        lastDomainItem.showInitiatives = lastDomainItem.initiatives &gt; 0;</span>
<span class="fc" id="L229">                        lastDomainItem.nameLines = escapeLines(wrapText(cleanName2, nameCharsPerLine, maxNameLines));</span>
<span class="fc" id="L230">                        lastDomainItem.capabilityLines = escapeLines(wrapText(cleanCapability2, capabilityCharsPerLine, maxCapabilityLines));</span>
<span class="fc" id="L231">                        lastDomainItem.nameHref = nameLink2.href;</span>
<span class="fc" id="L232">                        lastDomainItem.capabilityHref = capabilityLink2.href;</span>
<span class="fc" id="L233">                        lastDomainItem.initiativeStroke = computeInitiativeStroke(comp, gradientId, initiativeGradients);</span>
<span class="fc" id="L234">                        configureTextLayout(lastDomainItem, textCenterX, textLeftX, iconPosX);</span>
                    }

<span class="fc" id="L237">                    LinkText domainLink = parseLinkField(section.domainName);</span>
<span class="fc" id="L238">                    String domainLabel = sanitizeNullable(domainLink.text);</span>
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">                    DomainGroup group = new DomainGroup(domainLabel != null ? domainLabel : &quot;&quot;, section.iconId, domainItems);</span>
<span class="fc" id="L240">                    group.domainHref = domainLink.href;</span>
<span class="fc" id="L241">                    group.headerX = currentX;</span>
<span class="fc" id="L242">                    group.headerY = sectionStartY - headerOffset;</span>
<span class="fc" id="L243">                    group.headerTextY = group.headerY + 15f;</span>
<span class="fc" id="L244">                    group.headerIconY = group.headerY + 3f;</span>
<span class="fc" id="L245">                    group.headerWidth = columnWidth;</span>
<span class="fc" id="L246">                    group.headerTextX = columnWidth / 2f;</span>
<span class="fc" id="L247">                    group.showHeader = true;</span>

<span class="fc" id="L249">                    String headerKey = section.domainName + &quot;@&quot; + (int) rowTopY;</span>
<span class="fc" id="L250">                    HeaderSpan span = headerSpans.get(headerKey);</span>
<span class="pc bpc" id="L251" title="1 of 2 branches missed.">                    if (span == null) {</span>
<span class="fc" id="L252">                        span = new HeaderSpan();</span>
<span class="fc" id="L253">                        span.startX = currentX;</span>
<span class="fc" id="L254">                        span.rowY = group.headerY;</span>
<span class="fc" id="L255">                        span.width = columnWidth;</span>
<span class="fc" id="L256">                        span.primaryGroup = group;</span>
<span class="fc" id="L257">                        headerSpans.put(headerKey, span);</span>
                    } else {
<span class="nc" id="L259">                        span.width = (currentX + columnWidth) - span.startX;</span>
<span class="nc" id="L260">                        group.showHeader = false;</span>
<span class="nc" id="L261">                        group.headerWidth = 0;</span>
<span class="nc" id="L262">                        group.headerTextX = 0;</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                        if (span.primaryGroup != null) {</span>
<span class="nc" id="L264">                            span.primaryGroup.headerWidth = span.width;</span>
<span class="nc" id="L265">                            span.primaryGroup.headerTextX = span.width / 2f;</span>
                        }
                    }

<span class="fc" id="L269">                    domainGroups.add(group);</span>

<span class="pc bpc" id="L271" title="1 of 2 branches missed.">                    if (!comps.isEmpty()) {</span>
<span class="fc" id="L272">                        float lastY = sectionStartY + (comps.size() - 1) * (boxH + gapY);</span>
<span class="fc" id="L273">                        float sectionBottom = lastY + boxH;</span>
<span class="fc" id="L274">                        columnBottom = Math.max(columnBottom, sectionBottom);</span>
<span class="fc" id="L275">                        sectionStartY = sectionBottom + domainSectionGap;</span>
                    }
<span class="fc" id="L277">                }</span>

<span class="fc" id="L279">                rowBottomY = Math.max(rowBottomY, columnBottom);</span>
<span class="fc" id="L280">                currentX += columnWidth + gapX;</span>
<span class="fc" id="L281">                columnsInRow++;</span>
<span class="fc" id="L282">            }</span>

<span class="fc" id="L284">            float legendStartY = rowBottomY + DashboardLayoutConfig.LEGEND_TOP_MARGIN;</span>
<span class="fc" id="L285">            legendY = (int) legendStartY;</span>
<span class="fc" id="L286">        } else {</span>
<span class="nc" id="L287">            legendY = (int) (domainStartY + DashboardLayoutConfig.LEGEND_TOP_MARGIN);</span>
        }

        // Compute legend position defaults to below first row when no domains exist
<span class="pc bpc" id="L291" title="1 of 2 branches missed.">        if (legendY == 0) {</span>
<span class="nc" id="L292">            legendY = (int)(domainStartY + DashboardLayoutConfig.LEGEND_TOP_MARGIN);</span>
        }

        // Prepare legend data: Status on left, Maturity on right with precomputed x offsets
<span class="fc" id="L296">        java.util.List&lt;java.util.Map&lt;String, Object&gt;&gt; statusLegend = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L297">        statusLegend.add(legendEntry(ComponentItem.Status.NOT_EXISTING.displayName, ComponentItem.Status.NOT_EXISTING.hex, 0));</span>
<span class="fc" id="L298">        statusLegend.add(legendEntry(ComponentItem.Status.LOW.displayName, ComponentItem.Status.LOW.hex, 140));</span>
<span class="fc" id="L299">        statusLegend.add(legendEntry(ComponentItem.Status.MEDIUM.displayName, ComponentItem.Status.MEDIUM.hex, 280));</span>
<span class="fc" id="L300">        statusLegend.add(legendEntry(ComponentItem.Status.HIGH.displayName, ComponentItem.Status.HIGH.hex, 420));</span>
<span class="fc" id="L301">        statusLegend.add(legendEntry(ComponentItem.Status.EFFECTIVE.displayName, ComponentItem.Status.EFFECTIVE.hex, 560));</span>

<span class="fc" id="L303">        java.util.List&lt;java.util.Map&lt;String, Object&gt;&gt; maturityLegend = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L304">        maturityLegend.add(legendEntry(ComponentItem.Maturity.NOT_EXISTING.displayName, ComponentItem.Maturity.NOT_EXISTING.hex, 720));</span>
<span class="fc" id="L305">        maturityLegend.add(legendEntry(ComponentItem.Maturity.INITIAL.displayName, ComponentItem.Maturity.INITIAL.hex, 860));</span>
<span class="fc" id="L306">        maturityLegend.add(legendEntry(ComponentItem.Maturity.REPEATABLE.displayName, ComponentItem.Maturity.REPEATABLE.hex, 1000));</span>
<span class="fc" id="L307">        maturityLegend.add(legendEntry(ComponentItem.Maturity.DEFINED.displayName, ComponentItem.Maturity.DEFINED.hex, 1140));</span>
<span class="fc" id="L308">        maturityLegend.add(legendEntry(ComponentItem.Maturity.MANAGED.displayName, ComponentItem.Maturity.MANAGED.hex, 1280));</span>
<span class="fc" id="L309">        maturityLegend.add(legendEntry(ComponentItem.Maturity.OPTIMISED.displayName, ComponentItem.Maturity.OPTIMISED.hex, 1420));</span>

<span class="fc" id="L311">        int svgHeight = legendY + DashboardLayoutConfig.LEGEND_HEIGHT + DashboardLayoutConfig.BOTTOM_MARGIN;</span>
<span class="fc" id="L312">        float mmPerPixel = DashboardLayoutConfig.A4_WIDTH_MM / canvasWidth;</span>
<span class="fc" id="L313">        float svgHeightMm = svgHeight * mmPerPixel;</span>

<span class="fc" id="L315">        TemplateInstance data = dashboard</span>
<span class="fc" id="L316">            .data(&quot;title&quot;, title)</span>
<span class="fc" id="L317">            .data(&quot;titleHref&quot;, titleLink.href)</span>
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">            .data(&quot;governanceTitle&quot;, gov != null ? govTitle : null)</span>
<span class="fc" id="L319">            .data(&quot;governanceTitleHref&quot;, govTitleHref)</span>
<span class="fc" id="L320">            .data(&quot;governanceItems&quot;, governanceItems)</span>
<span class="pc bpc" id="L321" title="1 of 2 branches missed.">            .data(&quot;capabilitiesTitle&quot;, capabilities != null ? capabilitiesTitle : null)</span>
<span class="fc" id="L322">            .data(&quot;capabilitiesTitleHref&quot;, capabilitiesTitleHref)</span>
<span class="fc" id="L323">            .data(&quot;capabilitiesHeaderY&quot;, (int) capabilitiesHeaderY)</span>
<span class="fc" id="L324">            .data(&quot;capabilitiesTextY&quot;, (int) capabilitiesHeaderTextY)</span>
<span class="fc" id="L325">            .data(&quot;capabilitiesIconY&quot;, (int) capabilitiesIconY)</span>
<span class="pc bpc" id="L326" title="3 of 6 branches missed.">            .data(&quot;capabilitiesIcon&quot;, (capabilities != null &amp;&amp; capabilities.icon != null &amp;&amp; !capabilities.icon.isBlank()) ? (&quot;icon-&quot; + capabilities.icon.trim()) : null)</span>
<span class="pc bpc" id="L327" title="3 of 6 branches missed.">            .data(&quot;esaIcon&quot;, (root != null &amp;&amp; root.icon != null &amp;&amp; !root.icon.isBlank()) ? (&quot;icon-&quot; + root.icon.trim()) : null)</span>
<span class="fc" id="L328">            .data(&quot;domainGroups&quot;, domainGroups)</span>
<span class="fc" id="L329">            .data(&quot;boxW&quot;, (int) boxW)</span>
<span class="fc" id="L330">            .data(&quot;boxH&quot;, (int) boxH)</span>
<span class="fc" id="L331">            .data(&quot;halfBoxW&quot;, boxW / 2f)</span>
<span class="fc" id="L332">            .data(&quot;pageCenter&quot;, (int)(canvasWidth / 2f))</span>
<span class="fc" id="L333">            .data(&quot;legendY&quot;, legendY)</span>
<span class="fc" id="L334">            .data(&quot;statusLegend&quot;, statusLegend)</span>
<span class="fc" id="L335">            .data(&quot;maturityLegend&quot;, maturityLegend)</span>
<span class="fc" id="L336">            .data(&quot;initiativeGradients&quot;, initiativeGradients)</span>
<span class="fc" id="L337">            .data(&quot;canvasWidth&quot;, (int) canvasWidth)</span>
<span class="fc" id="L338">            .data(&quot;svgHeight&quot;, svgHeight)</span>
<span class="fc" id="L339">            .data(&quot;svgHeightMm&quot;, svgHeightMm)</span>
<span class="fc" id="L340">            .data(&quot;a4WidthMm&quot;, DashboardLayoutConfig.A4_WIDTH_MM);</span>
            // coordinates for initiatives badge inside a box (local to group)
<span class="fc" id="L342">            data = data</span>
<span class="fc" id="L343">            .data(&quot;initiativeCircleX&quot;, (int)(boxW - 10))</span>
<span class="fc" id="L344">            .data(&quot;initiativeCircleY&quot;, (int)(boxH - 12))</span>
<span class="fc" id="L345">            .data(&quot;initiativeTextY&quot;, (int)(boxH - 8));</span>
<span class="fc" id="L346">        String rendered = data.render();</span>
        // Basic sanity check in logs for debugging in tests
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">        if (rendered != null) {</span>
<span class="fc" id="L349">            String head = rendered.substring(0, Math.min(40, rendered.length())).replaceAll(&quot;\n&quot;, &quot;\\n&quot;);</span>
<span class="fc" id="L350">            Log.debugf(&quot;Rendered SVG head: %s&quot;, head);</span>
<span class="fc" id="L351">        } else {</span>
<span class="nc" id="L352">            Log.warn(&quot;Rendered SVG is null&quot;);</span>
        }
<span class="fc" id="L354">        return rendered;</span>
    }

    /**
     * Converts SVG content to PNG format using Apache Batik.
     * 
     * @param svgContent the SVG content as a string
     * @param dpi the DPI (dots per inch) for the PNG output
     * @return the PNG image as a byte array
     * @throws Exception if the conversion fails
     */
    public byte[] renderPngFromSvg(String svgContent, float dpi) throws Exception {
        // Convert SVG string to PNG bytes using Batik
<span class="fc" id="L367">        PNGTranscoder transcoder = new PNGTranscoder();</span>
        // set DPI if needed
<span class="fc" id="L369">        transcoder.addTranscodingHint(PNGTranscoder.KEY_PIXEL_UNIT_TO_MILLIMETER, 25.4f / dpi);</span>

<span class="fc" id="L371">        TranscoderInput input = new TranscoderInput(new ByteArrayInputStream(svgContent.getBytes(StandardCharsets.UTF_8)));</span>
<span class="fc" id="L372">        ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>
<span class="fc" id="L373">        TranscoderOutput output = new TranscoderOutput(baos);</span>
<span class="fc" id="L374">        transcoder.transcode(input, output);</span>
<span class="fc" id="L375">        baos.flush();</span>
<span class="fc" id="L376">        return baos.toByteArray();</span>
    }

    private void configureTextLayout(RenderItem item, float textCenterX, float textLeftX, float iconPosX) {
<span class="pc bpc" id="L380" title="2 of 6 branches missed.">        boolean hasDecorations = item.showInitiatives || (item.iconId != null &amp;&amp; !item.iconId.isBlank());</span>
<span class="pc bpc" id="L381" title="1 of 2 branches missed.">        item.textAnchor = hasDecorations ? &quot;start&quot; : &quot;middle&quot;;</span>
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">        item.textX = hasDecorations ? textLeftX : textCenterX;</span>
<span class="fc" id="L383">        item.iconX = iconPosX;</span>
<span class="fc" id="L384">    }</span>

    private String computeInitiativeStroke(ComponentItem comp, String baseId, java.util.List&lt;InitiativeGradient&gt; gradients) {
<span class="pc bpc" id="L387" title="1 of 4 branches missed.">        if (comp == null || comp.initiatives &lt;= 0) {</span>
<span class="fc" id="L388">            return &quot;#FFFFFF&quot;;</span>
        }
<span class="fc" id="L390">        String rag = comp.iRag;</span>
<span class="pc bpc" id="L391" title="1 of 2 branches missed.">        if (rag == null) {</span>
<span class="nc" id="L392">            return &quot;#FFFFFF&quot;;</span>
        }
<span class="fc" id="L394">        String normalized = rag.replaceAll(&quot;[^RAGrag]&quot;, &quot;&quot;).toUpperCase();</span>
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">        if (normalized.isEmpty()) {</span>
<span class="nc" id="L396">            return &quot;#FFFFFF&quot;;</span>
        }
<span class="fc" id="L398">        String gradientId = baseId + &quot;_initiative&quot;;</span>
<span class="fc" id="L399">        InitiativeGradient gradient = new InitiativeGradient(gradientId);</span>
<span class="fc" id="L400">        int len = normalized.length();</span>
<span class="fc bfc" id="L401" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="fc" id="L402">            float start = (float) i / len;</span>
<span class="fc" id="L403">            float end = (float) (i + 1) / len;</span>
<span class="fc" id="L404">            String color = colorForInitiativeRag(normalized.charAt(i));</span>
<span class="fc" id="L405">            gradient.stops.add(new GradientStop(start * 100f, color));</span>
<span class="fc" id="L406">            gradient.stops.add(new GradientStop(end * 100f, color));</span>
        }
<span class="fc" id="L408">        gradients.add(gradient);</span>
<span class="fc" id="L409">        return &quot;url(#&quot; + gradientId + &quot;)&quot;;</span>
    }

    private String colorForInitiativeRag(char c) {
<span class="fc" id="L413">        return ColorPalette.getInitiativeRagColor(c);</span>
    }

    private java.util.List&lt;DomainColumnLayout&gt; buildDomainColumns(java.util.List&lt;Domain&gt; domains, float boxWidth, float spaceWidth, int maxRowsPerColumn) {
<span class="fc" id="L417">        java.util.List&lt;DomainColumnLayout&gt; columns = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L418" title="All 2 branches covered.">        for (Domain domain : domains) {</span>
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">            if (domain == null) {</span>
<span class="nc" id="L420">                continue;</span>
            }
<span class="pc bpc" id="L422" title="1 of 2 branches missed.">            String domainName = domain.domain != null ? domain.domain : &quot;Domain&quot;;</span>
<span class="fc bfc" id="L423" title="All 2 branches covered.">            if (&quot;SPACE&quot;.equalsIgnoreCase(domainName)) {</span>
<span class="fc" id="L424">                columns.add(DomainColumnLayout.spacer(spaceWidth));</span>
<span class="fc" id="L425">                continue;</span>
            }
<span class="fc" id="L427">            java.util.List&lt;ComponentItem&gt; components = domain.components;</span>
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">            int originalSize = components != null ? components.size() : 0;</span>
<span class="pc bpc" id="L429" title="2 of 4 branches missed.">            boolean domainIsSmall = originalSize &gt; 0 &amp;&amp; originalSize &lt;= 3;</span>
<span class="fc" id="L430">            java.util.List&lt;DomainSectionChunk&gt; chunks = splitDomainIntoChunks(domainName, domain.icon, components, maxRowsPerColumn);</span>
<span class="fc bfc" id="L431" title="All 2 branches covered.">            for (DomainSectionChunk chunk : chunks) {</span>
<span class="fc" id="L432">                int rows = chunk.size();</span>
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">                if (rows == 0) continue;</span>
<span class="pc bpc" id="L434" title="2 of 4 branches missed.">                boolean isSmall = domainIsSmall &amp;&amp; rows &lt;= 3;</span>
<span class="fc bfc" id="L435" title="All 2 branches covered.">                DomainColumnLayout target = columns.isEmpty() ? null : columns.get(columns.size() - 1);</span>
<span class="pc bpc" id="L436" title="1 of 6 branches missed.">                if (isSmall &amp;&amp; target != null &amp;&amp; target.canAcceptSmall(rows, maxRowsPerColumn)) {</span>
<span class="fc" id="L437">                    target.sections.add(chunk);</span>
<span class="fc" id="L438">                    target.rowsUsed += rows;</span>
                } else {
<span class="fc" id="L440">                    DomainColumnLayout newCol = DomainColumnLayout.normal(boxWidth, isSmall);</span>
<span class="fc" id="L441">                    newCol.sections.add(chunk);</span>
<span class="fc" id="L442">                    newCol.rowsUsed = rows;</span>
<span class="fc" id="L443">                    columns.add(newCol);</span>
                }
<span class="fc" id="L445">            }</span>
<span class="fc" id="L446">        }</span>
<span class="fc" id="L447">        return columns;</span>
    }

    private java.util.List&lt;DomainSectionChunk&gt; splitDomainIntoChunks(String domainName, String icon, java.util.List&lt;ComponentItem&gt; components, int maxRowsPerColumn) {
<span class="fc" id="L451">        java.util.List&lt;DomainSectionChunk&gt; chunks = new java.util.ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L452" title="2 of 4 branches missed.">        if (components == null || components.isEmpty()) {</span>
<span class="nc" id="L453">            return chunks;</span>
        }
<span class="pc bpc" id="L455" title="2 of 4 branches missed.">        String iconId = (icon != null &amp;&amp; !icon.isBlank()) ? (&quot;icon-&quot; + icon.trim()) : null;</span>
<span class="fc" id="L456">        int total = components.size();</span>
<span class="pc bpc" id="L457" title="1 of 2 branches missed.">        if (total &lt;= maxRowsPerColumn) {</span>
<span class="fc" id="L458">            chunks.add(new DomainSectionChunk(domainName, iconId, new java.util.ArrayList&lt;&gt;(components)));</span>
<span class="fc" id="L459">            return chunks;</span>
        }
<span class="nc" id="L461">        int firstChunk = (int) Math.ceil(total / 2.0);</span>
<span class="nc" id="L462">        firstChunk = Math.min(firstChunk, maxRowsPerColumn);</span>
<span class="nc" id="L463">        chunks.add(new DomainSectionChunk(domainName, iconId, new java.util.ArrayList&lt;&gt;(components.subList(0, firstChunk))));</span>
<span class="nc" id="L464">        int index = firstChunk;</span>
<span class="nc" id="L465">        int remaining = total - firstChunk;</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">        while (remaining &gt; 0) {</span>
<span class="nc" id="L467">            int chunkSize = Math.min(maxRowsPerColumn, remaining);</span>
<span class="nc" id="L468">            chunks.add(new DomainSectionChunk(domainName, iconId, new java.util.ArrayList&lt;&gt;(components.subList(index, index + chunkSize))));</span>
<span class="nc" id="L469">            index += chunkSize;</span>
<span class="nc" id="L470">            remaining -= chunkSize;</span>
<span class="nc" id="L471">        }</span>
<span class="nc" id="L472">        return chunks;</span>
    }

    private java.util.List&lt;String&gt; wrapText(String value, int maxCharsPerLine, int maxLines) {
<span class="pc bpc" id="L476" title="2 of 4 branches missed.">        if (value == null || value.isBlank()) {</span>
<span class="nc" id="L477">            return java.util.Collections.singletonList(&quot;&quot;);</span>
        }
<span class="fc" id="L479">        int safeMaxLines = Math.max(1, maxLines);</span>
<span class="fc" id="L480">        int safeMaxChars = Math.max(1, maxCharsPerLine);</span>
<span class="fc" id="L481">        String[] words = value.trim().split(&quot;\\s+&quot;);</span>
<span class="fc" id="L482">        java.util.List&lt;String&gt; lines = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L483">        StringBuilder current = new StringBuilder();</span>
<span class="fc" id="L484">        int index = 0;</span>
<span class="fc bfc" id="L485" title="All 2 branches covered.">        while (index &lt; words.length) {</span>
<span class="fc" id="L486">            String word = words[index];</span>
<span class="fc bfc" id="L487" title="All 2 branches covered.">            String candidate = current.length() == 0 ? word : current + &quot; &quot; + word;</span>
<span class="pc bpc" id="L488" title="1 of 2 branches missed.">            if (candidate.length() &lt;= safeMaxChars) {</span>
<span class="fc" id="L489">                current = new StringBuilder(candidate);</span>
<span class="fc" id="L490">                index++;</span>
            } else {
<span class="nc bnc" id="L492" title="All 2 branches missed.">                if (current.length() == 0) {</span>
<span class="nc" id="L493">                    current = new StringBuilder(word.substring(0, Math.min(safeMaxChars, word.length())));</span>
<span class="nc" id="L494">                    index++;</span>
                }
<span class="nc" id="L496">                lines.add(current.toString());</span>
<span class="nc" id="L497">                current = new StringBuilder();</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">                if (lines.size() == safeMaxLines) {</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">                    if (index &lt; words.length) {</span>
<span class="nc" id="L500">                        lines.set(lines.size() - 1, addEllipsis(lines.get(lines.size() - 1), safeMaxChars));</span>
                    }
<span class="nc" id="L502">                    return lines;</span>
                }
            }
<span class="fc" id="L505">        }</span>
<span class="pc bpc" id="L506" title="1 of 2 branches missed.">        if (current.length() &gt; 0) {</span>
<span class="fc" id="L507">            lines.add(current.toString());</span>
        }
<span class="pc bpc" id="L509" title="1 of 2 branches missed.">        if (lines.isEmpty()) {</span>
<span class="nc" id="L510">            lines.add(&quot;&quot;);</span>
        }
<span class="fc" id="L512">        return lines;</span>
    }

    private String addEllipsis(String line, int maxCharsPerLine) {
<span class="nc bnc" id="L516" title="All 2 branches missed.">        String trimmed = line == null ? &quot;&quot; : line.trim();</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">        if (trimmed.length() &gt;= Math.max(1, maxCharsPerLine)) {</span>
<span class="nc" id="L518">            trimmed = trimmed.substring(0, Math.max(0, maxCharsPerLine - 1));</span>
        }
<span class="nc" id="L520">        return trimmed + &quot;...&quot;;</span>
    }

    private java.util.List&lt;String&gt; escapeLines(java.util.List&lt;String&gt; lines) {
<span class="pc bpc" id="L524" title="2 of 4 branches missed.">        if (lines == null || lines.isEmpty()) {</span>
<span class="nc" id="L525">            return java.util.Collections.singletonList(&quot;&quot;);</span>
        }
<span class="fc" id="L527">        java.util.List&lt;String&gt; escaped = new java.util.ArrayList&lt;&gt;(lines.size());</span>
<span class="fc bfc" id="L528" title="All 2 branches covered.">        for (String line : lines) {</span>
<span class="fc" id="L529">            escaped.add(escapeXml(line));</span>
<span class="fc" id="L530">        }</span>
<span class="fc" id="L531">        return escaped;</span>
    }

    private String sanitizeNullable(String value) {
<span class="pc bpc" id="L535" title="1 of 2 branches missed.">        return value == null ? null : StringUtils.escapeXml(value);</span>
    }

    private String escapeXml(String value) {
<span class="fc" id="L539">        return StringUtils.escapeXml(value);</span>
    }

    private java.util.Map&lt;String, Object&gt; legendEntry(String label, String color, int x) {
<span class="fc" id="L543">        java.util.Map&lt;String, Object&gt; entry = new java.util.LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L544">        String safeLabel = sanitizeNullable(label);</span>
<span class="pc bpc" id="L545" title="1 of 2 branches missed.">        entry.put(&quot;label&quot;, safeLabel != null ? safeLabel : &quot;&quot;);</span>
<span class="fc" id="L546">        entry.put(&quot;color&quot;, color);</span>
<span class="fc" id="L547">        entry.put(&quot;x&quot;, x);</span>
<span class="fc" id="L548">        return entry;</span>
    }

    private LinkText parseLinkField(String value) {
<span class="pc bpc" id="L552" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L553">            return new LinkText(null, null);</span>
        }
<span class="fc" id="L555">        String trimmed = value.trim();</span>
<span class="pc bpc" id="L556" title="1 of 2 branches missed.">        if (trimmed.endsWith(&quot;]&quot;)) {</span>
<span class="nc" id="L557">            int open = trimmed.lastIndexOf('[');</span>
<span class="nc bnc" id="L558" title="All 4 branches missed.">            if (open &gt;= 0 &amp;&amp; open &lt; trimmed.length() - 1) {</span>
<span class="nc" id="L559">                String encodedUrl = trimmed.substring(open + 1, trimmed.length() - 1).trim();</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">                if (!encodedUrl.isBlank()) {</span>
<span class="nc" id="L561">                    String label = trimmed.substring(0, open).trim();</span>
<span class="nc" id="L562">                    String decoded = decodeUrl(encodedUrl);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">                    return new LinkText(label.isEmpty() ? null : label, decoded);</span>
                }
            }
        }
<span class="fc" id="L567">        return new LinkText(value, null);</span>
    }

    private String decodeUrl(String value) {
<span class="nc" id="L571">        return UrlUtils.decode(value);</span>
    }

    private static class LinkText {
        final String text;
        final String href;

<span class="fc" id="L578">        LinkText(String text, String href) {</span>
<span class="fc" id="L579">            this.text = text;</span>
<span class="fc" id="L580">            this.href = href;</span>
<span class="fc" id="L581">        }</span>
    }

    private static class DomainSectionChunk {
        final String domainName;
        final String iconId;
        final java.util.List&lt;ComponentItem&gt; components;

<span class="fc" id="L589">        DomainSectionChunk(String domainName, String iconId, java.util.List&lt;ComponentItem&gt; components) {</span>
<span class="fc" id="L590">            this.domainName = domainName;</span>
<span class="fc" id="L591">            this.iconId = iconId;</span>
<span class="fc" id="L592">            this.components = components;</span>
<span class="fc" id="L593">        }</span>

        int size() {
<span class="pc bpc" id="L596" title="1 of 2 branches missed.">            return components != null ? components.size() : 0;</span>
        }
    }

    private static class DomainColumnLayout {
        final boolean spacer;
        final float width;
<span class="fc" id="L603">        final java.util.List&lt;DomainSectionChunk&gt; sections = new java.util.ArrayList&lt;&gt;();</span>
<span class="fc" id="L604">        int rowsUsed = 0;</span>
        boolean smallOnly;

<span class="fc" id="L607">        DomainColumnLayout(boolean spacer, float width, boolean smallOnly) {</span>
<span class="fc" id="L608">            this.spacer = spacer;</span>
<span class="fc" id="L609">            this.width = width;</span>
<span class="fc" id="L610">            this.smallOnly = smallOnly;</span>
<span class="fc" id="L611">        }</span>

        static DomainColumnLayout spacer(float width) {
<span class="fc" id="L614">            return new DomainColumnLayout(true, width, true);</span>
        }

        static DomainColumnLayout normal(float width, boolean smallOnly) {
<span class="fc" id="L618">            return new DomainColumnLayout(false, width, smallOnly);</span>
        }

        boolean canAcceptSmall(int additionalRows, int maxRowsPerColumn) {
<span class="pc bpc" id="L622" title="2 of 6 branches missed.">            return !spacer &amp;&amp; smallOnly &amp;&amp; rowsUsed + additionalRows &lt;= maxRowsPerColumn;</span>
        }
    }

    private static class HeaderSpan {
        float startX;
        float rowY;
        float width;
        DomainGroup primaryGroup;
    }

    private static class InitiativeGradient {
        public final String id;
<span class="fc" id="L635">        public final java.util.List&lt;GradientStop&gt; stops = new java.util.ArrayList&lt;&gt;();</span>

<span class="fc" id="L637">        InitiativeGradient(String id) {</span>
<span class="fc" id="L638">            this.id = id;</span>
<span class="fc" id="L639">        }</span>
    }

    private static class GradientStop {
        public final float offset;
        public final String color;

<span class="fc" id="L646">        GradientStop(float offset, String color) {</span>
<span class="fc" id="L647">            this.offset = offset;</span>
<span class="fc" id="L648">            this.color = color;</span>
<span class="fc" id="L649">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>